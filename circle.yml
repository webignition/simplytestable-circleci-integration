machine:
  php:
    version: 5.5.36
  environment:
    SYMFONY_ENV: prod

dependencies:
  cache_directories:
    - ~/.composer/cache

  pre:
    - printf "\n" | pecl install -f memcache
    - echo "extension = memcache.so" >> /opt/circleci/php/$(phpenv global)/etc/php.ini
    - echo "date.timezone = Europe/London" >> /opt/circleci/php/$(phpenv global)/etc/php.ini

  override:
    - sh ./build/install_worker.sh hydrogen

database:
  override:
    - mysql -u ubuntu < config/worker.simplytestable.com/create_user.sql
    -
    - php app/console doctrine:database:create:
        pwd: worker.simplytestable.com
    - php app/console doctrine:migrations:migrate --no-interaction:
        pwd: worker.simplytestable.com
    - php app/console doctrine:fixtures:load --no-interaction:
        pwd: worker.simplytestable.com

test:
  pre:
   - php app/console simplytestable:worker:activate:
       pwd: worker.simplytestable.com
  override:
    - echo foo
